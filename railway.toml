[build]
builder = "DOCKERFILE"
dockerfilePath = "Dockerfile"

[deploy]
startCommand = "milvus run standalone"
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10
# Disable Railway's built-in HTTP healthcheck
# Use Docker's HEALTHCHECK instead (defined in Dockerfile)
healthcheckPath = ""
healthcheckTimeout = 300

# Set PORT to 19530 - Railway will expose this port publicly
# This is the main Milvus gRPC port that clients should connect to
[deploy.environmentVariables]
PORT = "19530"

# Volume configuration for data persistence
[[deploy.volumes]]
mountPath = "/var/lib/milvus"
name = "milvus-data"

# Expose service variables for other Railway services
[deploy.serviceVariables]
MILVUS_HOST = "${{RAILWAY_PRIVATE_DOMAIN}}"
MILVUS_PORT = "19530"
MILVUS_GRPC_PORT = "19530"
MILVUS_METRICS_PORT = "9091"
MILVUS_ETCD_PORT = "2379"
MILVUS_URI = "http://${{RAILWAY_PRIVATE_DOMAIN}}:19530"
